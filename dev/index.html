<html>
<head>
<meta charset="UTF-8">
<title>Cauliflower v0.1</title>

<!-- for jquery -->
<link rel="stylesheet" href="jquery/css//jquery-ui-1.8.22.custom.css">
<script type="text/javascript" src="jquery/jquery-1.7.2.min.js"></script>
<script type="text/javascript" src="jquery/jquery-ui-1.8.22.custom.min.js"></script>
<script type="text/javascript" src="jquery/jquery.cookie.js"></script>
<script type="text/javascript">
<!--
	$(function() {
		$("#tabs").tabs({
			select: function(event, ui){
				if(ui.index == 0){
					Blockly.mainWorkspace.render();
				}else if(ui.index ==1){
					
				}
			},
			cookie : {
				expires : 3　//選択タブをcookieで3日間保存
			}
		});
	});
	
// -->
</script>

<!-- for codemirror -->
<link rel=stylesheet href="codemirror/lib/codemirror.css">
<link rel="stylesheet" href="codemirror/theme/default.css">
<script type="text/javascript" src="codemirror/lib/codemirror.js"></script>
<script type="text/javascript" src="codemirror/mode/xml/xml.js"></script>
<script type="text/javascript" src="codemirror/mode/javascript/javascript.js"></script>
<script type="text/javascript" src="codemirror/mode/css/css.js></script"></script>
<script type="text/javascript" src="codemirror/mode/htmlmixed/htmlmixed.js"></script>
<style type=text/css>
.CodeMirror {
	position: relative;
	width: 50%;
}

#html_preview {
	width: 40%;
	position: absolute;
	top: 50px;
	right: 20px;
	height: 300px;
	border: 1px solid black;
}

#blockly_frame {
	width: 100%;
	height: 100%;
	border: none;
}
</style>
<script type="text/javascript">
<!--
var editor;
$(function(){
	var delay;
    editor = CodeMirror.fromTextArea(document.getElementById("html_textarea"), {
      mode: "text/html",
      theme: "default",
      tabMode: "indent",
      lineNumbers: "true",
      fixedGutter: "true",
      electricChars: "true",
      onChange: function() {
        clearTimeout(delay);
        delay = setTimeout(updatePreview, 300);
      }
    });
    
    var httpObj = $.get("html_template.txt", null, function(){
    	 editor.setValue(httpObj.responseText);
    });
    
    $("#new_button").button().click(function(){
    	alert("新規作成");
 	});
    $("#open_button").button().click(function(){
    	alert("読み込み");
 	});
    $("#save_button").button().click(function(){
    	alert("保存する");
 	});
    $("#exec_button").button().css({"background": "#ffcc00"}).click(function(){//とりあえず色を変える要グラデーション
    	alert("実行する");
 	});
    $("#html_new_botton").button();
    
    
    function updatePreview() {
      var previewFrame = document.getElementById("html_preview");
      var preview =  previewFrame.contentDocument ||  previewFrame.contentWindow.document;
      preview.open();
      preview.write(editor.getValue());
      preview.close();
    }
    setTimeout(updatePreview, 300);
});

function getHTMLCode() {
	  alert(editor.getValue());
}
//-->
</script>
</head>
<body>
    <h1>Cauliflower v0.1</h1>
    <p>
        <button id="new_button">新規</button>
        <button id="open_button">開く</button>
        <button id="save_button">保存</button>
        &nbsp;&nbsp;
        <button id="exec_button">プレビュー</button>
    </p>
    <div id="tabs">
        <ul>
            <li><a href="#tab-javascript">JavaScript</a></li>
            <li><a href="#tab-html">HTML</a></li>
        </ul>
        <div id="tab-javascript">
            <iframe id="blockly_frame" src="../demos/codejp/frame.html"></iframe>
        </div>
        <div id="tab-html">
            <p>
                <a href="javascript:getHTMLCode();">テスト用：HTMLを取得</a>
            </p>
            <p>
                <button id="html_new_botton">新規作成</button>
            </p>
            <textarea id="html_textarea"></textarea>
            <iframe id="html_preview"></iframe>
        </div>
    </div>
</body>
</html>